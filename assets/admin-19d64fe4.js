import{a as w}from"./axios-bee0f54a.js";let k=document.querySelector(".menuToggle"),L=document.querySelectorAll(".topBar-menu a"),f=document.querySelector(".topBar-menu");k.addEventListener("click",B);L.forEach(e=>{e.addEventListener("click",T)});function B(){f.classList.contains("openMenu")?f.classList.remove("openMenu"):f.classList.add("openMenu")}function T(){f.classList.remove("openMenu")}let R="3MqEVCXgUfWPBU1z05uHAjqjnzi2";const p=w.create({baseURL:"https://livejs-api.hexschool.io/api/livejs/v1/admin",headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json"}});p.interceptors.request.use(function(e){return e.headers.Authorization=R,e},function(e){return Promise.reject(e)});p.interceptors.response.use(function(e){return e},function(e){return e.request.status,Promise.reject(e)});let v="absinthe";function j(){return p({url:`/${v}/orders`,method:"GET"})}function D(e,t){return p({url:`/${v}/orders`,method:"PUT",data:{data:{id:e,paid:t}}})}function x(e){return p({url:`/${v}/orders/${e}`,method:"DELETE"})}function M(){return p({url:`/${v}/orders`,method:"DELETE"})}let b=document.querySelector(".orderPage-tbody"),P=document.querySelector(".discardAllBtn"),m=document.querySelector(".section-revenue"),S=document.querySelector(".title-one"),A=document.querySelector(".title-two"),o=[],h="",l=!0,c=!0;function C(e){let t=new Date(e*1e3);return`<p>${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()}</p>`}function F(e){let t="";return e.forEach(function(r){let i=r.price*r.quantity;t+=`<p><span>${r.title}(${r.price})</span> X <span>${r.quantity} ，共 ${i}元</span></p>`}),t}function U(e){if(e)return"已處理";if(!e)return"未處理"}function y(e){e.forEach(function(t){let r=U(t.paid),i=F(t.products),a=C(t.createdAt);h+=`<tr>
                        <td>${t.id}</td>
                        <td>
                            <p>${t.user.name}</p>
                            <p>${t.user.tel}</p>
                        </td>
                        <td>${t.user.address}</td>
                        <td>${t.user.email}</td>
                        <td>
                            <p>${i}</p>
                        </td>
                        <td>${a}</td>
                        <td class="orderStatus">
                            <a href="#"  data-put='revisebtn' data-pain=${t.paid} data-id=${t.id} >${r}</a>
                        </td>
                        <td>
                            <input type="button" class="delSingleOrder-Btn" value="刪除" data-orderbtn="del" data-id=${t.id} />
                        </td>
                    </tr>`})}function g(){b.innerHTML+=h}function E(){h="",b.innerHTML=h}function z(e){return e!=="true"}function H(e,t){return t.find(function(i){return e===i.id}).paid}function q(){if(o.length===0)return[];let e=[];return o.forEach(function(r){e.push(r.products)}),e.reduce(function(r,i){return r.concat(i)},[])}function O(){if(o.length===0)return[];let e=q(),t=[],r=[],i=e.reduce(function(a,n){return n.category in a?a[n.category]=a[n.category]+n.price*n.quantity:a[n.category]=n.price*n.quantity,a},{});return t=Object.keys(i),t.forEach(function(a){let n=[];n.push(a),n.push(i[a]),r.push(n)}),r}function $(){if(o.length===0)return[];let e=q(),t=[],r=[],i=[],a=3,n=e.reduce(function(s,u){return u.title in s?s[u.title]=s[u.title]+u.price*u.quantity:s[u.title]=u.price*u.quantity,s},{});if(t=Object.keys(n),t.forEach(function(s){let u=[];u.push(s),u.push(n[s]),r.push(u)}),r.sort(function(s,u){return s[1]-u[1]}),r.length<a)return r;for(;i.length<a;)if(i.push(r.pop()),i.length===a){let s=0;for(let u=0;u<r.length;u++)s=s+r[u][1];i.push(["其他",s])}return i}function d(e){c3.generate({bindto:"#chart",data:{type:"pie",columns:e},color:{pattern:["#FF0000","#EE7700","#66DD00","#009FCC"]}})}m.addEventListener("change",function(e){if(e.target.value==="類別營收比重"){let t=O();d(t),S.style.display="none",A.style.display="block"}if(e.target.value==="全品項營收比重"){let t=$();d(t),S.style.display="block",A.style.display="none"}});b.addEventListener("click",async function(e){e.preventDefault();let t=e.target.getAttribute("data-id"),r=e.target.getAttribute("data-put"),i=z(e.target.getAttribute("data-pain")),a=e.target.getAttribute("data-orderbtn");if(r==="revisebtn"&&c){l=!1,c=!1;try{o=(await D(t,i)).data.orders,H(t,o)?Swal.fire({icon:"success",text:"買家已付款",timer:1e3,showConfirmButton:!1}):Swal.fire({icon:"error",text:"買家未付款",timer:1e3,showConfirmButton:!1}),l=!0,c=!0,E(),y(o),g()}catch(n){n.response.data.status||Swal.fire({icon:"error",title:" ",text:`${n.response.data.message}`}),l=!0,c=!0}}if(a==="del"&&l){l=!1,c=!1;try{let n=await x(t);o=n.data.orders,n.data.status&&Swal.fire({icon:"success",title:" ",text:"該筆訂單已刪除"}),l=!0,c=!0,E(),y(o),g(),m.value==="全品項營收比重"?d($()):d(O())}catch(n){n.response.data.status||Swal.fire({icon:"error",title:" ",text:`${n.response.data.message}`}),l=!0,c=!0}}});P.addEventListener("click",async function(){if(l){l=!1,c=!1;try{let e=await M();e.data.status&&Swal.fire({icon:"success",title:" ",text:`${e.data.message}`}),l=!0,c=!0,o=[],E(),y(o),g(),d([])}catch(e){e.response.data.status||Swal.fire({icon:"error",title:" ",text:`${e.response.data.message}`}),l=!0,c=!0}}});async function I(){o=(await j()).data.orders,S.style.display="block",A.style.display="none",y(o),g(),$(),d($())}I();
