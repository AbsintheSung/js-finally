import{a as ne}from"./axios-bee0f54a.js";document.addEventListener("DOMContentLoaded",function(){const n=document.querySelector(".recommendation-wall");n.style.cursor="grab";let a={top:0,left:0,x:0,y:0};const l=function(s){n.style.cursor="grabbing",n.style.userSelect="none",a={left:n.scrollLeft,top:n.scrollTop,x:s.clientX,y:s.clientY},document.addEventListener("mousemove",d),document.addEventListener("mouseup",c)},d=function(s){const u=s.clientX-a.x,f=s.clientY-a.y;n.scrollTop=a.top-f,n.scrollLeft=a.left-u},c=function(){n.style.cursor="grab",n.style.removeProperty("user-select"),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",c)};n.addEventListener("mousedown",l)});let ae=document.querySelector(".menuToggle"),re=document.querySelectorAll(".topBar-menu a"),w=document.querySelector(".topBar-menu");ae.addEventListener("click",le);re.forEach(n=>{n.addEventListener("click",oe)});function le(){w.classList.contains("openMenu")?w.classList.remove("openMenu"):w.classList.add("openMenu")}function oe(){w.classList.remove("openMenu")}const v=ne.create({baseURL:"https://livejs-api.hexschool.io/api/livejs/v1/customer",headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json"}});let x="absinthe";function de(){return v({url:`/${x}/products`,method:"GET"})}function ce(n,a){return v({url:`/${x}/carts`,method:"POST",data:{data:{productId:n,quantity:a}}})}function se(){return v({url:`/${x}/carts`,method:"GET"})}function ie(n){return v({url:`/${x}/carts/${n}`,method:"DELETE"})}function ue(){return v({url:`/${x}/carts`,method:"DELETE"})}function me({name:n,tel:a,email:l,address:d,payment:c}){return console.log({data:{data:{user:{name:n,tel:a,email:l,address:d,payment:c}}}}),v({url:`/${x}/orders`,method:"POST",data:{data:{user:{name:n,tel:a,email:l,address:d,payment:c}}}})}let p=document.createDocumentFragment();function pe(n,a){let l=document.createElement("div"),d=new Image,c=document.createElement("p");return l.classList.add("cardItem-title"),d.src=`${n}`,d.alt="圖片",c.textContent=`${a}`,p.appendChild(d),p.appendChild(c),l.appendChild(p),l}function fe(n){let a=document.createElement("td"),l=pe(n.images,n.title);return p.appendChild(l),a.appendChild(p),a}function he(n){let a=document.createDocumentFragment(),l=document.createElement("td"),d=document.createElement("a"),c=ge();return l.classList.add("discardBtn"),d.href="#",d.classList.add("material-icons","a-delbtn"),d.textContent="clear",d.setAttribute("data-delcartid",`${n}`),d.setAttribute("data-delbtn","delOneData"),a.appendChild(d),a.appendChild(c),l.appendChild(a),l}function ge(){let n=document.createElement("button"),a=document.createElement("span");return n.classList.add("loadind-cart","spinner-border","text-dark"),n.role="status",a.classList.add("visually-hidden"),a.textContent="Loading...",p.appendChild(a),n.appendChild(p),n}function ye(n){let a=document.createElement("tr"),l=fe(n.product),d=document.createElement("td"),c=document.createElement("td"),s=document.createElement("td"),u=he(n.id);return a.classList.add("cartItem"),d.textContent=`NT$${n.product.price.toLocaleString()}`,c.textContent=n.quantity,s.textContent=`NT$${(n.product.price*n.quantity).toLocaleString()}`,p.appendChild(l),p.appendChild(d),p.appendChild(c),p.appendChild(s),p.appendChild(u),a.appendChild(p),a}let y=document.createDocumentFragment();function Ce(){let n=document.createElement("button"),a=document.createElement("span");return n.classList.add("loadind-btn","spinner-border","text-white","bg-dark"),n.role="status",a.classList.add("visually-hidden"),a.textContent="Loading...",y.appendChild(a),n.appendChild(y),n}function Le(n){let a=document.createElement("li"),l=document.createElement("h4"),d=document.createElement("h3"),c=document.createElement("del"),s=document.createElement("p"),u=document.createElement("a"),f=new Image,b=Ce();return l.textContent="新品",l.classList.add("productType"),d.textContent=n.title,f.src=n.images,f.alt="圖片",u.href="",u.classList.add("addCardBtn"),u.setAttribute("data-addcartid",`${n.id}`),u.textContent="加入購物車",u.appendChild(b),c.classList.add("originPrice"),c.textContent=`NT$ ${n.origin_price.toLocaleString()}`,s.classList.add("nowPrice"),s.textContent=`NT$ ${n.price.toLocaleString()}`,a.classList.add("productCard"),y.appendChild(l),y.appendChild(f),y.appendChild(u),y.appendChild(d),y.appendChild(c),y.appendChild(s),a.appendChild(y),a}(function(){let n=document.querySelector(".productWrap"),a=document.querySelector(".shoppingCart-table"),l=document.querySelector(".tbody"),d=document.querySelector(".productSelect"),c=document.querySelector(".final-total"),s=document.querySelector(".discardAllBtn"),u=document.querySelector("form"),f=document.querySelectorAll(".orderInfo-input"),b=document.querySelectorAll(".orderInfo-message"),T=document.querySelector(".orderInfo-btn"),C=document.createDocumentFragment(),N=document.querySelector(".show-cart-table"),_=document.querySelector(".show-no-cart");document.querySelector(".modal-body");let D=[],$=[],I=[],k=[],h=[],q=[],E=[],L=!0,i=!0,A=!0;function H(e,t){e.forEach(function(r){let o=Le(r);C.appendChild(o)}),t.appendChild(C)}function U(e){e.forEach(function(t,r){t!=null?$[r].style.display="block":$[r].style.display="none"})}function M(e){e?k.forEach(function(t){t.classList.remove("add-loading")}):k.forEach(function(t){t.classList.add("add-loading")})}function O(e,t){let r=a.getElementsByTagName("tr").length-1,o=a.getElementsByTagName("tr")[r];e.forEach(function(m){let te=ye(m);C.appendChild(te)}),t.insertBefore(C,o)}function G(){let e=a.getElementsByTagName("tr").length-1,t=a.getElementsByTagName("tr")[0],r=a.getElementsByTagName("tr")[e];for(;l.firstChild;)l.removeChild(l.firstChild);C.appendChild(t),C.appendChild(r),l.appendChild(C)}function P(e){e.length===0?(N.style.display="none",_.style.display="block"):(N.style.display="block",_.style.display="none")}function B(){G(),O(h,l),P(h),q=Array.from(document.querySelectorAll(".loadind-cart")),E=Array.from(document.querySelectorAll(".a-delbtn"))}function V(e){I[e].style.display="block"}function F(e){I[e].style.display="none"}function X(e){q[e].style.display="block",E[e].style.display="none"}function S(e){e?E.forEach(function(t){t.classList.remove("del-loading")}):E.forEach(function(t){t.classList.add("del-loading")})}function Y(){q.forEach(function(e){e.style.display="block"}),E.forEach(function(e){e.style.display="none"})}function z(e){let t={},r=h.find(function(o){return o.product.id===e});return r?(t.id=e,t.quantity=r.quantity+1):(t.id=e,t.quantity=1),t}function Q(e,t){return t.map(function(o,m){if(o.category===`${e}`)return m})}function W(e){return D.findIndex(function(r){return r.id===e})}function j(e){return h.findIndex(function(r){return r.id===e})}function g(e,t,r,o){Swal.fire({icon:e,title:t,timer:r,showConfirmButton:o})}n.addEventListener("click",async function(e){e.preventDefault();let t=e.target.getAttribute("data-addcartid");if(e.target.getAttribute("class")==="addCardBtn"&&L){let r=W(t),o=z(t);L=!1,V(r),M(L);try{let m=await ce(o.id,o.quantity);h=m.data.carts,L=!0,B(),F(r),M(L),g("success","已成功加入購物車",800,!1),c.textContent=`NT$ ${m.data.finalTotal.toLocaleString()}`}catch(m){m.response.data.status||g("error",`${m.response.data.message}`,!1,!0),L=!0,F(r),M(L)}}}),d.addEventListener("change",function(e){let t=e.target.value;if(e.target.value==="全部")$.forEach(function(r){r.style.display="block"});else{let r=Q(t,D);U(r)}}),a.addEventListener("click",async function(e){e.preventDefault();let t=e.target.getAttribute("data-delcartid");if(e.target.getAttribute("data-delBtn")==="delOneData"&&i){i=!1,X(j(t)),S(i);try{let o=await ie(t);h=o.data.carts,i=!0,B(),S(i),g("success","已將商品移除",800,!1),c.textContent=`NT$ ${o.data.finalTotal.toLocaleString()}`}catch{error.response.data.status||g("error",`${error.response.data.message}`,!1,!0),i=!0,S(i)}}}),s.addEventListener("click",async function(e){if(e.preventDefault(),i){i=!1,S(i);try{Y();let t=await ue();h=t.data.carts,i=!0,B(),S(i),g("success","已將商品全部移除",800,!1),c.textContent=`NT$ ${t.data.finalTotal.toLocaleString()}`}catch{error.response.data.status||g("error",`${error.response.data.message}`,!1,!0),i=!0,S(i)}}});async function J(){R();try{let e=await de(),t=await se();D=e.data.products,h=t.data.carts,H(D,n),O(h,l),P(h),$=Array.from(document.querySelectorAll(".productCard")),I=Array.from(document.querySelectorAll(".loadind-btn")),q=Array.from(document.querySelectorAll(".loadind-cart")),E=document.querySelectorAll(".a-delbtn"),k=document.querySelectorAll(".addCardBtn"),c.textContent=`NT$ ${t.data.finalTotal.toLocaleString()}`}catch(e){e.response.data.status||g("error",`${e.response.data.message}`,!1,!0)}}J();let K={姓名:{presence:{message:"必填"}},電話:{presence:{message:"必填"}},Email:{presence:{message:"必填"},email:{message:"須符合Email格式"}},寄送地址:{presence:{message:"必填"}}};T.addEventListener("click",async function(e){e.preventDefault();const t=validate(u,K);if(t){let o=Z(t);ee(o);return}R();let r={name:f[0].value,tel:f[1].value,email:f[2].value,address:f[3].value,payment:f[4].value};if(A){A=!1,T.classList.add("send-loading");try{(await me(r)).status&&(h=[],A=!0,T.classList.remove("send-loading"),B(),g("success","訂單已成立",!1,!0),u.reset(),c.textContent="NT$ 0")}catch(o){o.response.data.status||g("error",`${o.response.data.message}`,!1,!0),A=!0,T.classList.remove("send-loading")}}});function R(){b.forEach(function(e){e.textContent=""})}function Z(e){let t=[],r={姓名:0,電話:1,Email:2,寄送地址:3};return Object.entries(e).forEach(function(o){let m=[];m.push(r[o[0]]),m.push(o[1][0].replace(o[0],"")),t.push(m)}),t}function ee(e){for(let t=0;t<e.length;t++)b[e[t][0]].style.display="block",b[e[t][0]].textContent=e[t][1].trim()}})();
