import{a as q}from"./axios-bee0f54a.js";let O=document.querySelector(".menuToggle"),w=document.querySelectorAll(".topBar-menu a"),d=document.querySelector(".topBar-menu");O.addEventListener("click",k);w.forEach(e=>{e.addEventListener("click",L)});function k(){d.classList.contains("openMenu")?d.classList.remove("openMenu"):d.classList.add("openMenu")}function L(){d.classList.remove("openMenu")}let B="3MqEVCXgUfWPBU1z05uHAjqjnzi2";const c=q.create({baseURL:"https://livejs-api.hexschool.io/api/livejs/v1/admin",headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json"}});c.interceptors.request.use(function(e){return e.headers.Authorization=B,e},function(e){return Promise.reject(e)});c.interceptors.response.use(function(e){return e},function(e){return e.request.status,Promise.reject(e)});let g="absinthe";function T(){return c({url:`/${g}/orders`,method:"GET"})}function R(e,t){return c({url:`/${g}/orders`,method:"PUT",data:{data:{id:e,paid:t}}})}function j(e){return c({url:`/${g}/orders/${e}`,method:"DELETE"})}function D(){return c({url:`/${g}/orders`,method:"DELETE"})}let E=document.querySelector(".orderPage-tbody"),x=document.querySelector(".discardAllBtn"),S=document.querySelector(".section-revenue"),$=document.querySelector(".title-one"),v=document.querySelector(".title-two"),o=[],p="";function M(e){let t=new Date(e*1e3);return`<p>${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()}</p>`}function P(e){let t="";return e.forEach(function(r){let i=r.price*r.quantity;t+=`<p><span>${r.title}(${r.price})</span> X <span>${r.quantity} ，共 ${i}元</span></p>`}),t}function C(e){if(e)return"已處理";if(!e)return"未處理"}function f(e){e.forEach(function(t){let r=C(t.paid),i=P(t.products),s=M(t.createdAt);p+=`<tr>
                        <td>${t.id}</td>
                        <td>
                            <p>${t.user.name}</p>
                            <p>${t.user.tel}</p>
                        </td>
                        <td>${t.user.address}</td>
                        <td>${t.user.email}</td>
                        <td>
                            <p>${i}</p>
                        </td>
                        <td>${s}</td>
                        <td class="orderStatus">
                            <a href="#"  data-put='revisebtn' data-pain=${t.paid} data-id=${t.id} >${r}</a>
                        </td>
                        <td>
                            <input type="button" class="delSingleOrder-Btn" value="刪除" data-orderbtn="del" data-id=${t.id} />
                        </td>
                    </tr>`})}function h(){E.innerHTML+=p}function A(){p="",E.innerHTML=p}function F(e){return e!=="true"}function U(e,t){return t.find(function(i){return e===i.id}).paid}function b(){if(o.length===0)return[];let e=[];return o.forEach(function(r){e.push(r.products)}),e.reduce(function(r,i){return r.concat(i)},[])}function m(){if(o.length===0)return[];let e=b(),t=[],r=[],i=e.reduce(function(s,n){return n.category in s?s[n.category]=s[n.category]+n.price*n.quantity:s[n.category]=n.price*n.quantity,s},{});return t=Object.keys(i),t.forEach(function(s){let n=[];n.push(s),n.push(i[s]),r.push(n)}),r}function y(){if(o.length===0)return[];let e=b(),t=[],r=[],i=[],s=3,n=e.reduce(function(u,a){return a.title in u?u[a.title]=u[a.title]+a.price*a.quantity:u[a.title]=a.price*a.quantity,u},{});if(t=Object.keys(n),t.forEach(function(u){let a=[];a.push(u),a.push(n[u]),r.push(a)}),r.sort(function(u,a){return u[1]-a[1]}),r.length<s)return r;for(;i.length<s;)if(i.push(r.pop()),i.length===s){let u=0;for(let a=0;a<r.length;a++)u=u+r[a][1];i.push(["其他",u])}return i}function l(e){c3.generate({bindto:"#chart",data:{type:"pie",columns:e},color:{pattern:["#FF0000","#EE7700","#66DD00","#009FCC"]}})}S.addEventListener("change",function(e){if(e.target.value==="類別營收比重"){let t=m();l(t),$.style.display="none",v.style.display="block"}if(e.target.value==="全品項營收比重"){let t=y();l(t),$.style.display="block",v.style.display="none"}});E.addEventListener("click",async function(e){e.preventDefault();let t=e.target.getAttribute("data-id"),r=e.target.getAttribute("data-put"),i=F(e.target.getAttribute("data-pain")),s=e.target.getAttribute("data-orderbtn");if(r==="revisebtn")try{o=(await R(t,i)).data.orders,U(t,o)?Swal.fire({icon:"success",text:"買家已付款",timer:1e3,showConfirmButton:!1}):Swal.fire({icon:"error",text:"買家未付款",timer:1e3,showConfirmButton:!1}),A(),f(o),h()}catch(n){n.response.data.status||Swal.fire({icon:"error",title:" ",text:`${n.response.data.message}`})}if(s==="del")try{let n=await j(t);o=n.data.orders,n.data.status&&Swal.fire({icon:"success",title:" ",text:"該筆訂單已刪除"}),A(),f(o),h(),S.value==="全品項營收比重"?l(y()):l(m())}catch(n){n.response.data.status||Swal.fire({icon:"error",title:" ",text:`${n.response.data.message}`})}});x.addEventListener("click",async function(){try{let e=await D();e.data.status&&Swal.fire({icon:"success",title:" ",text:`${e.data.message}`}),o=[],A(),f(o),h(),l([])}catch(e){e.response.data.status||Swal.fire({icon:"error",title:" ",text:`${e.response.data.message}`})}});async function z(){o=(await T()).data.orders,$.style.display="block",v.style.display="none",f(o),h(),y(),l(y())}z();
