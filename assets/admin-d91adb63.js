import{a as O}from"./axios-ca79552b.js";let S="3MqEVCXgUfWPBU1z05uHAjqjnzi2";const u=O.create({baseURL:"https://livejs-api.hexschool.io/api/livejs/v1/admin",headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json"}});u.interceptors.request.use(function(t){return t.headers.Authorization=S,console.log("config in request interceptor",t),t},function(t){return Promise.reject(t)});u.interceptors.response.use(function(t){return t},function(t){return t.request.status,Promise.reject(t)});let h="absinthe";function q(){return u({url:`/${h}/orders`,method:"GET"})}function w(t,r){return u({url:`/${h}/orders`,method:"PUT",data:{data:{id:t,paid:r}}})}function j(t){return u({url:`/${h}/orders/${t}`,method:"DELETE"})}function k(){return u({url:`/${h}/orders`,method:"DELETE"})}let v=document.querySelector(".orderPage-tbody"),D=document.querySelector(".discardAllBtn"),A=document.querySelector(".section-revenue"),g=document.querySelector(".title-one"),y=document.querySelector(".title-two"),s=[],c="";function T(t){let r=new Date(t*1e3);return`<p>${r.getFullYear()}/${r.getMonth()+1}/${r.getDate()}</p>`}function P(t){let r="";return t.forEach(function(n){let a=n.price*n.quantity;r+=`<p><span>${n.title}(${n.price})</span> X <span>${n.quantity} ，共 ${a}元</span></p>`}),r}function x(t){if(t)return"已處理";if(!t)return"未處理"}function p(t){t.forEach(function(r){let n=x(r.paid),a=P(r.products),o=T(r.createdAt);c+=`<tr>
                        <td>${r.id}</td>
                        <td>
                            <p>${r.user.name}</p>
                            <p>${r.user.tel}</p>
                        </td>
                        <td>${r.user.address}</td>
                        <td>${r.user.email}</td>
                        <td>
                            <p>${a}</p>
                        </td>
                        <td>${o}</td>
                        <td class="orderStatus">
                            <a href="#"  data-put='revisebtn' data-pain=${r.paid} data-id=${r.id} >${n}</a>
                        </td>
                        <td>
                            <input type="button" class="delSingleOrder-Btn" value="刪除" data-orderbtn="del" data-id=${r.id} />
                        </td>
                    </tr>`})}function f(){v.innerHTML+=c}function $(){c="",v.innerHTML=c}function L(t){return t!=="true"}function E(){if(s.length===0)return[];let t=[];s.forEach(function(n){t.push(n.products)});let r=t.reduce(function(n,a){return n.concat(a)},[]);return console.log("一開始要處理的",r),r}function b(){if(s.length===0)return[];let t=E(),r=[],n=[];console.log("類別 準備處理",t);let a=t.reduce(function(o,e){return e.category in o?o[e.category]=o[e.category]+e.price*e.quantity:o[e.title]=e.price*e.quantity,o},{});return console.log("類別 以處理",a),r=Object.keys(a),r.forEach(function(o){let e=[];e.push(o),e.push(a[o]),n.push(e)}),n}function d(){if(s.length===0)return[];let t=E(),r=[],n=[],a=[],o=t.reduce(function(e,i){return i.title in e?e[i.title]=e[i.title]+i.price*i.quantity:e[i.title]=i.price*i.quantity,e},{});if(console.log("全部 以處理",o),r=Object.keys(o),r.forEach(function(e){let i=[];i.push(e),i.push(o[e]),n.push(i)}),n.sort(function(e,i){return e[1]-i[1]}),n.length<3)return n;for(;a.length<3&&t.length!=0;)if(a.push(n.pop()),a.length===3){let e=0;for(let i=0;i<n.length;i++)e=e+n[i][1];a.push(["其他",e])}return a}function l(t){c3.generate({bindto:"#chart",data:{type:"pie",columns:t},color:{pattern:["#FF0000","#EE7700","#66DD00","#009FCC"]}})}async function R(){s=(await q()).data.orders,g.style.display="block",y.style.display="none",console.log("初始化",s),p(s),f(),d(),l(d())}R();A.addEventListener("change",function(t){if(t.target.value==="類別營收比重"){let r=b();l(r),g.style.display="none",y.style.display="block"}if(t.target.value==="全品項營收比重"){let r=d();l(r),g.style.display="block",y.style.display="none"}});v.addEventListener("click",async function(t){t.preventDefault();let r=t.target.getAttribute("data-id"),n=t.target.getAttribute("data-put"),a=L(t.target.getAttribute("data-pain")),o=t.target.getAttribute("data-orderbtn");if(n==="revisebtn")try{s=(await w(r,a)).data.orders,Swal.fire({icon:"success",title:" ",text:"買家已付款",timer:800}),$(),p(s),f()}catch(e){e.response.data.status||Swal.fire({icon:"error",title:" ",text:`${e.response.data.message}`})}if(o==="del")try{let e=await j(r);console.log("刪除回應",e.data.orders),s=e.data.orders,e.data.status&&Swal.fire({icon:"success",title:" ",text:"該筆訂單已刪除"}),$(),p(s),f(),A.value==="全品項營收比重"?l(d()):l(b())}catch(e){e.response.data.status||Swal.fire({icon:"error",title:" ",text:`${e.response.data.message}`})}});D.addEventListener("click",async function(){try{let t=await k();t.data.status&&Swal.fire({icon:"success",title:" ",text:`${t.data.message}`}),s=[],$(),p(s),f(),A.value==="全品項營收比重"?l(d()):l(b())}catch(t){t.response.data.status||Swal.fire({icon:"error",title:" ",text:`${t.response.data.message}`})}});
