import{a as et}from"./axios-55335edb.js";const L=et.create({baseURL:"https://livejs-api.hexschool.io/api/livejs/v1/customer",headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json"}});let x="absinthe";function nt(){return L({url:`/${x}/products`,method:"GET"})}function at(n,a){return L({url:`/${x}/carts`,method:"POST",data:{data:{productId:n,quantity:a}}})}function rt(){return L({url:`/${x}/carts`,method:"GET"})}function lt(n){return L({url:`/${x}/carts/${n}`,method:"DELETE"})}function dt(){return L({url:`/${x}/carts`,method:"DELETE"})}function ot({name:n,tel:a,email:l,address:o,payment:c}){return console.log({data:{data:{user:{name:n,tel:a,email:l,address:o,payment:c}}}}),L({url:`/${x}/orders`,method:"POST",data:{data:{user:{name:n,tel:a,email:l,address:o,payment:c}}}})}let u=document.createDocumentFragment();function ct(n,a){let l=document.createElement("div"),o=new Image,c=document.createElement("p");return l.classList.add("cardItem-title"),o.src=`${n}`,o.alt="圖片",c.textContent=`${a}`,u.appendChild(o),u.appendChild(c),l.appendChild(u),l}function it(n){let a=document.createElement("td"),l=ct(n.images,n.title);return u.appendChild(l),a.appendChild(u),a}function st(n){let a=document.createDocumentFragment(),l=document.createElement("td"),o=document.createElement("a"),c=ut();return l.classList.add("discardBtn"),o.href="#",o.classList.add("material-icons","a-delbtn"),o.textContent="clear",o.setAttribute("data-delcartid",`${n}`),o.setAttribute("data-delbtn","delOneData"),a.appendChild(o),a.appendChild(c),l.appendChild(a),l}function ut(){let n=document.createElement("button"),a=document.createElement("span");return n.classList.add("loadind-cart","spinner-border","text-dark"),n.role="status",a.classList.add("visually-hidden"),a.textContent="Loading...",u.appendChild(a),n.appendChild(u),n}function pt(n){let a=document.createElement("tr"),l=it(n.product),o=document.createElement("td"),c=document.createElement("td"),g=document.createElement("td"),p=st(n.id);return a.classList.add("cartItem"),o.textContent=`NT$${n.product.price.toLocaleString()}`,c.textContent=n.quantity,g.textContent=`NT$${n.product.price.toLocaleString()}`,u.appendChild(l),u.appendChild(o),u.appendChild(c),u.appendChild(g),u.appendChild(p),a.appendChild(u),a}let h=document.createDocumentFragment();function mt(){let n=document.createElement("button"),a=document.createElement("span");return n.classList.add("loadind-btn","spinner-border","text-white","bg-dark"),n.role="status",a.classList.add("visually-hidden"),a.textContent="Loading...",h.appendChild(a),n.appendChild(h),n}function ft(n){let a=document.createElement("li"),l=document.createElement("h4"),o=document.createElement("h3"),c=document.createElement("del"),g=document.createElement("p"),p=document.createElement("a"),f=new Image,D=mt();return l.textContent="新品",l.classList.add("productType"),o.textContent=n.title,f.src=n.images,f.alt="圖片",p.href="",p.classList.add("addCardBtn"),p.setAttribute("data-addcartid",`${n.id}`),p.textContent="加入購物車",p.appendChild(D),c.classList.add("originPrice"),c.textContent=`NT$ ${n.origin_price.toLocaleString()}`,g.classList.add("nowPrice"),g.textContent=`NT$ ${n.price.toLocaleString()}`,a.classList.add("productCard"),h.appendChild(l),h.appendChild(f),h.appendChild(p),h.appendChild(o),h.appendChild(c),h.appendChild(g),a.appendChild(h),a}(function(){let n=document.querySelector(".productWrap"),a=document.querySelector(".shoppingCart-table"),l=document.querySelector(".tbody"),o=document.querySelector(".productSelect"),c=document.querySelector(".final-total"),g=document.querySelector(".discardAllBtn"),p=document.querySelector("form"),f=document.querySelectorAll(".orderInfo-input"),D=document.querySelectorAll(".orderInfo-message"),P=document.querySelector(".orderInfo-btn"),C=document.createDocumentFragment(),B=document.querySelector(".show-cart-table"),k=document.querySelector(".show-no-cart");document.querySelector(".modal-body");let T=[],$=[],A=[],q=[],m=[],v=[],S=[],y=!0,i=!0;function F(t,e){t.forEach(function(r){let d=ft(r);C.appendChild(d)}),e.appendChild(C)}function R(t){t.forEach(function(e,r){e!=null?$[r].style.display="block":$[r].style.display="none"})}function I(t){t?q.forEach(function(e){e.classList.remove("add-loading")}):q.forEach(function(e){e.classList.add("add-loading")})}function N(t,e){let r=a.getElementsByTagName("tr").length-1,d=a.getElementsByTagName("tr")[r];t.forEach(function(s){let tt=pt(s);C.appendChild(tt)}),e.insertBefore(C,d)}function G(){let t=a.getElementsByTagName("tr").length-1,e=a.getElementsByTagName("tr")[0],r=a.getElementsByTagName("tr")[t];for(;l.firstChild;)l.removeChild(l.firstChild);C.appendChild(e),C.appendChild(r),l.appendChild(C)}function _(t){t.length===0?(B.style.display="none",k.style.display="block"):(B.style.display="block",k.style.display="none")}function b(){G(),N(m,l),_(m),v=Array.from(document.querySelectorAll(".loadind-cart")),S=Array.from(document.querySelectorAll(".a-delbtn"))}function U(t){A[t].style.display="block"}function O(t){A[t].style.display="none"}function V(t){v[t].style.display="block",S[t].style.display="none"}function E(t){t?S.forEach(function(e){e.classList.remove("del-loading")}):S.forEach(function(e){e.classList.add("del-loading")})}function z(){v.forEach(function(t){t.style.display="block"}),S.forEach(function(t){t.style.display="none"})}function Q(t){let e={},r=m.find(function(d){return d.product.id===t});return r?(e.id=t,e.quantity=r.quantity+1):(e.id=t,e.quantity=1),e}function W(t,e){return e.map(function(d,s){if(d.category===`${t}`)return s})}function j(t){return T.findIndex(function(r){return r.id===t})}function H(t){return m.findIndex(function(r){return r.id===t})}const J=Swal.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:1500,background:"#9D9D9D",didOpen:t=>{t.onmouseenter=Swal.stopTimer,t.onmouseleave=Swal.resumeTimer}});function w(t,e){J.fire({icon:t,title:e})}n.addEventListener("click",async function(t){t.preventDefault();let e=t.target.getAttribute("data-addcartid");if(t.target.getAttribute("class")==="addCardBtn"&&y){let r=j(e),d=Q(e);y=!1,U(r),I(y);try{let s=await at(d.id,d.quantity);m=s.data.carts,y=!0,b(),O(r),I(y),w("success","已成功加入"),c.textContent=`NT$ ${s.data.finalTotal.toLocaleString()}`}catch(s){s.response.data.status||Swal.fire({icon:"error",title:" ",text:`${s.response.data.message}`}),y=!0,O(r),I(y)}}}),o.addEventListener("change",function(t){let e=t.target.value;if(t.target.value==="全部")$.forEach(function(r){r.style.display="block"});else{let r=W(e,T);R(r)}}),a.addEventListener("click",async function(t){t.preventDefault();let e=t.target.getAttribute("data-delcartid");if(t.target.getAttribute("data-delBtn")==="delOneData"&&i){i=!1,V(H(e)),E(i);try{let d=await lt(e);m=d.data.carts,i=!0,b(),E(i),w("success","已將商品移除"),c.textContent=`NT$ ${d.data.finalTotal.toLocaleString()}`}catch{error.response.data.status||Swal.fire({icon:"error",title:" ",text:`${error.response.data.message}`}),i=!0,E(i)}}}),g.addEventListener("click",async function(t){t.preventDefault(),i=!1,E(i);try{z();let e=await dt();m=e.data.carts,i=!0,b(),E(i),w("success","已將商品全部移除"),c.textContent=`NT$ ${e.data.finalTotal.toLocaleString()}`}catch{error.response.data.status||Swal.fire({icon:"error",title:" ",text:`${error.response.data.message}`}),i=!0,E(i)}});async function K(){M();try{let t=await nt(),e=await rt();T=t.data.products,m=e.data.carts,F(T,n),N(m,l),_(m),console.log(T),$=Array.from(document.querySelectorAll(".productCard")),A=Array.from(document.querySelectorAll(".loadind-btn")),v=Array.from(document.querySelectorAll(".loadind-cart")),S=document.querySelectorAll(".a-delbtn"),q=document.querySelectorAll(".addCardBtn"),c.textContent=`NT$ ${e.data.finalTotal.toLocaleString()}`}catch(t){t.response.data.status||Swal.fire({icon:"error",title:" ",text:`${t.response.data.message}`})}}K();let X={姓名:{presence:{message:"必填"}},電話:{presence:{message:"必填"}},Email:{presence:{message:"必填"},email:{message:"須符合Email格式"}},寄送地址:{presence:{message:"必填"}}};P.addEventListener("click",async function(t){t.preventDefault();const e=validate(p,X);if(e){let d=Y(e);Z(d);return}M();let r={name:f[0].value,tel:f[1].value,email:f[2].value,address:f[3].value,payment:f[4].value};try{(await ot(r)).status&&(m=[],b(),w("success","訂單已成立"),p.reset(),c.textContent="NT$ 0")}catch(d){d.response.data.status||Swal.fire({icon:"error",title:" ",text:`${d.response.data.message}`})}});function M(){D.forEach(function(t){t.textContent=""})}function Y(t){let e=[],r={姓名:0,電話:1,Email:2,寄送地址:3};return Object.entries(t).forEach(function(d){let s=[];s.push(r[d[0]]),s.push(d[1][0].replace(d[0],"")),e.push(s)}),e}function Z(t){for(let e=0;e<t.length;e++)D[t[e][0]].style.display="block",D[t[e][0]].textContent=t[e][1].trim()}})();
