import{a as S}from"./axios-ca79552b.js";let q="3MqEVCXgUfWPBU1z05uHAjqjnzi2";const l=S.create({baseURL:"https://livejs-api.hexschool.io/api/livejs/v1/admin",headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json"}});l.interceptors.request.use(function(t){return t.headers.Authorization=q,console.log("config in request interceptor",t),t},function(t){return Promise.reject(t)});l.interceptors.response.use(function(t){return t},function(t){return t.request.status,Promise.reject(t)});let y="absinthe";function w(){return l({url:`/${y}/orders`,method:"GET"})}function k(t,e){return l({url:`/${y}/orders`,method:"PUT",data:{data:{id:t,paid:e}}})}function j(t){return l({url:`/${y}/orders/${t}`,method:"DELETE"})}function D(){return l({url:`/${y}/orders`,method:"DELETE"})}let A=document.querySelector(".orderPage-tbody"),T=document.querySelector(".discardAllBtn"),b=document.querySelector(".section-revenue"),g=document.querySelector(".title-one"),$=document.querySelector(".title-two"),o=[],c="";function P(t){let e=new Date(t*1e3);return`<p>${e.getFullYear()}/${e.getMonth()+1}/${e.getDate()}</p>`}function x(t){let e="";return t.forEach(function(r){let a=r.price*r.quantity;e+=`<p><span>${r.title}(${r.price})</span> X <span>${r.quantity} ，共 ${a}元</span></p>`}),e}function L(t){if(t)return"已處理";if(!t)return"未處理"}function p(t){t.forEach(function(e){let r=L(e.paid),a=x(e.products),s=P(e.createdAt);c+=`<tr>
                        <td>${e.id}</td>
                        <td>
                            <p>${e.user.name}</p>
                            <p>${e.user.tel}</p>
                        </td>
                        <td>${e.user.address}</td>
                        <td>${e.user.email}</td>
                        <td>
                            <p>${a}</p>
                        </td>
                        <td>${s}</td>
                        <td class="orderStatus">
                            <a href="#"  data-put='revisebtn' data-pain=${e.paid} data-id=${e.id} >${r}</a>
                        </td>
                        <td>
                            <input type="button" class="delSingleOrder-Btn" value="刪除" data-orderbtn="del" data-id=${e.id} />
                        </td>
                    </tr>`})}function f(){A.innerHTML+=c}function v(){c="",A.innerHTML=c}function R(t){return t!=="true"}function E(){if(o.length===0)return[];let t=[];return o.forEach(function(r){t.push(r.products)}),t.reduce(function(r,a){return r.concat(a)},[])}function O(){if(o.length===0)return[];let t=E(),e=[],r=[],a=t.reduce(function(s,n){return n.category in s?s[n.category]=s[n.category]+n.price*n.quantity:s[n.category]=n.price*n.quantity,s},{});return e=Object.keys(a),e.forEach(function(s){let n=[];n.push(s),n.push(a[s]),r.push(n)}),r}function h(){if(o.length===0)return[];let t=E(),e=[],r=[],a=[],s=3,n=t.reduce(function(u,i){return i.title in u?u[i.title]=u[i.title]+i.price*i.quantity:u[i.title]=i.price*i.quantity,u},{});if(e=Object.keys(n),e.forEach(function(u){let i=[];i.push(u),i.push(n[u]),r.push(i)}),r.sort(function(u,i){return u[1]-i[1]}),r.length<s)return r;for(;a.length<s;)if(a.push(r.pop()),a.length===s){let u=0;for(let i=0;i<r.length;i++)u=u+r[i][1];a.push(["其他",u])}return a}function d(t){c3.generate({bindto:"#chart",data:{type:"pie",columns:t},color:{pattern:["#FF0000","#EE7700","#66DD00","#009FCC"]}})}b.addEventListener("change",function(t){if(t.target.value==="類別營收比重"){let e=O();d(e),g.style.display="none",$.style.display="block"}if(t.target.value==="全品項營收比重"){let e=h();d(e),g.style.display="block",$.style.display="none"}});A.addEventListener("click",async function(t){t.preventDefault();let e=t.target.getAttribute("data-id"),r=t.target.getAttribute("data-put"),a=R(t.target.getAttribute("data-pain")),s=t.target.getAttribute("data-orderbtn");if(r==="revisebtn")try{o=(await k(e,a)).data.orders,Swal.fire({icon:"success",title:" ",text:"買家已付款",timer:800}),v(),p(o),f()}catch(n){n.response.data.status||Swal.fire({icon:"error",title:" ",text:`${n.response.data.message}`})}if(s==="del")try{let n=await j(e);o=n.data.orders,n.data.status&&Swal.fire({icon:"success",title:" ",text:"該筆訂單已刪除"}),v(),p(o),f(),b.value==="全品項營收比重"?d(h()):d(O())}catch(n){n.response.data.status||Swal.fire({icon:"error",title:" ",text:`${n.response.data.message}`})}});T.addEventListener("click",async function(){try{let t=await D();t.data.status&&Swal.fire({icon:"success",title:" ",text:`${t.data.message}`}),o=[],v(),p(o),f(),d([])}catch(t){t.response.data.status||Swal.fire({icon:"error",title:" ",text:`${t.response.data.message}`})}});async function B(){o=(await w()).data.orders,g.style.display="block",$.style.display="none",p(o),f(),h(),d(h())}B();
