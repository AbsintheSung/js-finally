import{a as w}from"./axios-bee0f54a.js";let O="3MqEVCXgUfWPBU1z05uHAjqjnzi2";const l=w.create({baseURL:"https://livejs-api.hexschool.io/api/livejs/v1/admin",headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json"}});l.interceptors.request.use(function(t){return t.headers.Authorization=O,t},function(t){return Promise.reject(t)});l.interceptors.response.use(function(t){return t},function(t){return t.request.status,Promise.reject(t)});let y="absinthe";function q(){return l({url:`/${y}/orders`,method:"GET"})}function k(t,e){return l({url:`/${y}/orders`,method:"PUT",data:{data:{id:t,paid:e}}})}function R(t){return l({url:`/${y}/orders/${t}`,method:"DELETE"})}function j(){return l({url:`/${y}/orders`,method:"DELETE"})}let A=document.querySelector(".orderPage-tbody"),D=document.querySelector(".discardAllBtn"),b=document.querySelector(".section-revenue"),g=document.querySelector(".title-one"),$=document.querySelector(".title-two"),u=[],c="";function T(t){let e=new Date(t*1e3);return`<p>${e.getFullYear()}/${e.getMonth()+1}/${e.getDate()}</p>`}function m(t){let e="";return t.forEach(function(r){let i=r.price*r.quantity;e+=`<p><span>${r.title}(${r.price})</span> X <span>${r.quantity} ，共 ${i}元</span></p>`}),e}function x(t){if(t)return"已處理";if(!t)return"未處理"}function p(t){t.forEach(function(e){let r=x(e.paid),i=m(e.products),s=T(e.createdAt);c+=`<tr>
                        <td>${e.id}</td>
                        <td>
                            <p>${e.user.name}</p>
                            <p>${e.user.tel}</p>
                        </td>
                        <td>${e.user.address}</td>
                        <td>${e.user.email}</td>
                        <td>
                            <p>${i}</p>
                        </td>
                        <td>${s}</td>
                        <td class="orderStatus">
                            <a href="#"  data-put='revisebtn' data-pain=${e.paid} data-id=${e.id} >${r}</a>
                        </td>
                        <td>
                            <input type="button" class="delSingleOrder-Btn" value="刪除" data-orderbtn="del" data-id=${e.id} />
                        </td>
                    </tr>`})}function f(){A.innerHTML+=c}function v(){c="",A.innerHTML=c}function P(t){return t!=="true"}function B(t,e){return e.find(function(i){return t===i.id}).paid}function E(){if(u.length===0)return[];let t=[];return u.forEach(function(r){t.push(r.products)}),t.reduce(function(r,i){return r.concat(i)},[])}function S(){if(u.length===0)return[];let t=E(),e=[],r=[],i=t.reduce(function(s,n){return n.category in s?s[n.category]=s[n.category]+n.price*n.quantity:s[n.category]=n.price*n.quantity,s},{});return e=Object.keys(i),e.forEach(function(s){let n=[];n.push(s),n.push(i[s]),r.push(n)}),r}function h(){if(u.length===0)return[];let t=E(),e=[],r=[],i=[],s=3,n=t.reduce(function(o,a){return a.title in o?o[a.title]=o[a.title]+a.price*a.quantity:o[a.title]=a.price*a.quantity,o},{});if(e=Object.keys(n),e.forEach(function(o){let a=[];a.push(o),a.push(n[o]),r.push(a)}),r.sort(function(o,a){return o[1]-a[1]}),console.log(Array.from(r)),r.length<s)return r;for(;i.length<s;)if(i.push(r.pop()),i.length===s){let o=0;for(let a=0;a<r.length;a++)o=o+r[a][1];i.push(["其他",o])}return i}function d(t){c3.generate({bindto:"#chart",data:{type:"pie",columns:t},color:{pattern:["#FF0000","#EE7700","#66DD00","#009FCC"]}})}b.addEventListener("change",function(t){if(t.target.value==="類別營收比重"){let e=S();d(e),g.style.display="none",$.style.display="block"}if(t.target.value==="全品項營收比重"){let e=h();d(e),g.style.display="block",$.style.display="none"}});A.addEventListener("click",async function(t){t.preventDefault();let e=t.target.getAttribute("data-id"),r=t.target.getAttribute("data-put"),i=P(t.target.getAttribute("data-pain")),s=t.target.getAttribute("data-orderbtn");if(r==="revisebtn")try{let n=await k(e,i);console.log("reviseRes回應",n),u=n.data.orders,B(e,u)?Swal.fire({icon:"success",text:"買家已付款",timer:1e3,showConfirmButton:!1}):Swal.fire({icon:"error",text:"買家未付款",timer:1e3,showConfirmButton:!1}),v(),p(u),f()}catch(n){n.response.data.status||Swal.fire({icon:"error",title:" ",text:`${n.response.data.message}`})}if(s==="del")try{let n=await R(e);u=n.data.orders,n.data.status&&Swal.fire({icon:"success",title:" ",text:"該筆訂單已刪除"}),v(),p(u),f(),b.value==="全品項營收比重"?d(h()):d(S())}catch(n){n.response.data.status||Swal.fire({icon:"error",title:" ",text:`${n.response.data.message}`})}});D.addEventListener("click",async function(){try{let t=await j();t.data.status&&Swal.fire({icon:"success",title:" ",text:`${t.data.message}`}),u=[],v(),p(u),f(),d([])}catch(t){t.response.data.status||Swal.fire({icon:"error",title:" ",text:`${t.response.data.message}`})}});async function L(){u=(await q()).data.orders,g.style.display="block",$.style.display="none",p(u),f(),h(),d(h())}L();
