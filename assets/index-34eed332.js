import{a as et}from"./axios-ca79552b.js";const v=et.create({baseURL:"https://livejs-api.hexschool.io/api/livejs/v1/customer",headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json"}});let x="absinthe";function at(){return v({url:`/${x}/products`,method:"GET"})}function nt(a,n){return v({url:`/${x}/carts`,method:"POST",data:{data:{productId:a,quantity:n}}})}function rt(){return v({url:`/${x}/carts`,method:"GET"})}function lt(a){return v({url:`/${x}/carts/${a}`,method:"DELETE"})}function dt(){return v({url:`/${x}/carts`,method:"DELETE"})}function ot({name:a,tel:n,email:d,address:o,payment:c}){return console.log({data:{data:{user:{name:a,tel:n,email:d,address:o,payment:c}}}}),v({url:`/${x}/orders`,method:"POST",data:{data:{user:{name:a,tel:n,email:d,address:o,payment:c}}}})}let u=document.createDocumentFragment();function ct(a,n){let d=document.createElement("div"),o=new Image,c=document.createElement("p");return d.classList.add("cardItem-title"),o.src=`${a}`,o.alt="圖片",c.textContent=`${n}`,u.appendChild(o),u.appendChild(c),d.appendChild(u),d}function st(a){let n=document.createElement("td"),d=ct(a.images,a.title);return u.appendChild(d),n.appendChild(u),n}function it(a){let n=document.createDocumentFragment(),d=document.createElement("td"),o=document.createElement("a"),c=ut();return d.classList.add("discardBtn"),o.href="#",o.classList.add("material-icons","a-delbtn"),o.textContent="clear",o.setAttribute("data-delcartid",`${a}`),o.setAttribute("data-delbtn","delOneData"),n.appendChild(o),n.appendChild(c),d.appendChild(n),d}function ut(){let a=document.createElement("button"),n=document.createElement("span");return a.classList.add("loadind-cart","spinner-border","text-dark"),a.role="status",n.classList.add("visually-hidden"),n.textContent="Loading...",u.appendChild(n),a.appendChild(u),a}function pt(a){let n=document.createElement("tr"),d=st(a.product),o=document.createElement("td"),c=document.createElement("td"),C=document.createElement("td"),p=it(a.id);return n.classList.add("cartItem"),o.textContent=`NT$${a.product.price.toLocaleString()}`,c.textContent=a.quantity,C.textContent=`NT$${a.product.price.toLocaleString()}`,u.appendChild(d),u.appendChild(o),u.appendChild(c),u.appendChild(C),u.appendChild(p),n.appendChild(u),n}let g=document.createDocumentFragment();function mt(){let a=document.createElement("button"),n=document.createElement("span");return a.classList.add("loadind-btn","spinner-border","text-white","bg-dark"),a.role="status",n.classList.add("visually-hidden"),n.textContent="Loading...",g.appendChild(n),a.appendChild(g),a}function ft(a){let n=document.createElement("li"),d=document.createElement("h4"),o=document.createElement("h3"),c=document.createElement("del"),C=document.createElement("p"),p=document.createElement("a"),f=new Image,$=mt();return d.textContent="新品",d.classList.add("productType"),o.textContent=a.title,f.src=a.images,f.alt="圖片",p.href="",p.classList.add("addCardBtn"),p.setAttribute("data-addcartid",`${a.id}`),p.textContent="加入購物車",p.appendChild($),c.classList.add("originPrice"),c.textContent=`NT$ ${a.origin_price.toLocaleString()}`,C.classList.add("nowPrice"),C.textContent=`NT$ ${a.price.toLocaleString()}`,n.classList.add("productCard"),g.appendChild(d),g.appendChild(f),g.appendChild(p),g.appendChild(o),g.appendChild(c),g.appendChild(C),n.appendChild(g),n}(function(){let a=document.querySelector(".productWrap"),n=document.querySelector(".shoppingCart-table"),d=document.querySelector(".tbody"),o=document.querySelector(".productSelect"),c=document.querySelector(".final-total"),C=document.querySelector(".discardAllBtn"),p=document.querySelector("form"),f=document.querySelectorAll(".orderInfo-input"),$=document.querySelectorAll(".orderInfo-message"),b=document.querySelector(".orderInfo-btn"),y=document.createDocumentFragment(),N=document.querySelector(".show-cart-table"),_=document.querySelector(".show-no-cart");document.querySelector(".modal-body");let D=[],T=[],B=[],w=[],m=[],A=[],S=[],L=!0,s=!0,q=!0;function R(t,e){t.forEach(function(r){let l=ft(r);y.appendChild(l)}),e.appendChild(y)}function G(t){t.forEach(function(e,r){e!=null?T[r].style.display="block":T[r].style.display="none"})}function k(t){t?w.forEach(function(e){e.classList.remove("add-loading")}):w.forEach(function(e){e.classList.add("add-loading")})}function O(t,e){let r=n.getElementsByTagName("tr").length-1,l=n.getElementsByTagName("tr")[r];t.forEach(function(i){let tt=pt(i);y.appendChild(tt)}),e.insertBefore(y,l)}function U(){let t=n.getElementsByTagName("tr").length-1,e=n.getElementsByTagName("tr")[0],r=n.getElementsByTagName("tr")[t];for(;d.firstChild;)d.removeChild(d.firstChild);y.appendChild(e),y.appendChild(r),d.appendChild(y)}function M(t){t.length===0?(N.style.display="none",_.style.display="block"):(N.style.display="block",_.style.display="none")}function I(){U(),O(m,d),M(m),A=Array.from(document.querySelectorAll(".loadind-cart")),S=Array.from(document.querySelectorAll(".a-delbtn"))}function V(t){B[t].style.display="block"}function P(t){B[t].style.display="none"}function z(t){A[t].style.display="block",S[t].style.display="none"}function E(t){t?S.forEach(function(e){e.classList.remove("del-loading")}):S.forEach(function(e){e.classList.add("del-loading")})}function Q(){A.forEach(function(t){t.style.display="block"}),S.forEach(function(t){t.style.display="none"})}function W(t){let e={},r=m.find(function(l){return l.product.id===t});return r?(e.id=t,e.quantity=r.quantity+1):(e.id=t,e.quantity=1),e}function j(t,e){return e.map(function(l,i){if(l.category===`${t}`)return i})}function H(t){return D.findIndex(function(r){return r.id===t})}function J(t){return m.findIndex(function(r){return r.id===t})}function h(t,e,r,l){Swal.fire({icon:t,title:e,timer:r,showConfirmButton:l})}a.addEventListener("click",async function(t){t.preventDefault();let e=t.target.getAttribute("data-addcartid");if(t.target.getAttribute("class")==="addCardBtn"&&L){let r=H(e),l=W(e);L=!1,V(r),k(L);try{let i=await nt(l.id,l.quantity);m=i.data.carts,L=!0,I(),P(r),k(L),h("success","已成功加入購物車",800,!1),c.textContent=`NT$ ${i.data.finalTotal.toLocaleString()}`}catch(i){i.response.data.status||h("error",`${i.response.data.message}`,!1,!0),L=!0,P(r),k(L)}}}),o.addEventListener("change",function(t){let e=t.target.value;if(t.target.value==="全部")T.forEach(function(r){r.style.display="block"});else{let r=j(e,D);G(r)}}),n.addEventListener("click",async function(t){t.preventDefault();let e=t.target.getAttribute("data-delcartid");if(t.target.getAttribute("data-delBtn")==="delOneData"&&s){s=!1,z(J(e)),E(s);try{let l=await lt(e);m=l.data.carts,s=!0,I(),E(s),h("success","已將商品移除",800,!1),c.textContent=`NT$ ${l.data.finalTotal.toLocaleString()}`}catch{error.response.data.status||h("error",`${error.response.data.message}`,!1,!0),s=!0,E(s)}}}),C.addEventListener("click",async function(t){if(t.preventDefault(),s){s=!1,E(s);try{Q();let e=await dt();m=e.data.carts,s=!0,I(),E(s),h("success","已將商品全部移除",800,!1),c.textContent=`NT$ ${e.data.finalTotal.toLocaleString()}`}catch{error.response.data.status||h("error",`${error.response.data.message}`,!1,!0),s=!0,E(s)}}});async function K(){F();try{let t=await at(),e=await rt();D=t.data.products,m=e.data.carts,R(D,a),O(m,d),M(m),console.log(D),T=Array.from(document.querySelectorAll(".productCard")),B=Array.from(document.querySelectorAll(".loadind-btn")),A=Array.from(document.querySelectorAll(".loadind-cart")),S=document.querySelectorAll(".a-delbtn"),w=document.querySelectorAll(".addCardBtn"),c.textContent=`NT$ ${e.data.finalTotal.toLocaleString()}`}catch(t){t.response.data.status||h("error",`${t.response.data.message}`,!1,!0)}}K();let X={姓名:{presence:{message:"必填"}},電話:{presence:{message:"必填"}},Email:{presence:{message:"必填"},email:{message:"須符合Email格式"}},寄送地址:{presence:{message:"必填"}}};b.addEventListener("click",async function(t){t.preventDefault();const e=validate(p,X);if(e){let l=Y(e);Z(l);return}F();let r={name:f[0].value,tel:f[1].value,email:f[2].value,address:f[3].value,payment:f[4].value};if(q){q=!1,b.classList.add("send-loading");try{(await ot(r)).status&&(m=[],q=!0,b.classList.remove("send-loading"),I(),h("success","訂單已成立",!1,!0),p.reset(),c.textContent="NT$ 0")}catch(l){l.response.data.status||h("error",`${l.response.data.message}`,!1,!0),q=!0,b.classList.remove("send-loading")}}});function F(){$.forEach(function(t){t.textContent=""})}function Y(t){let e=[],r={姓名:0,電話:1,Email:2,寄送地址:3};return Object.entries(t).forEach(function(l){let i=[];i.push(r[l[0]]),i.push(l[1][0].replace(l[0],"")),e.push(i)}),e}function Z(t){for(let e=0;e<t.length;e++)$[t[e][0]].style.display="block",$[t[e][0]].textContent=t[e][1].trim()}})();
