import{a as w}from"./axios-bee0f54a.js";let O="3MqEVCXgUfWPBU1z05uHAjqjnzi2";const l=w.create({baseURL:"https://livejs-api.hexschool.io/api/livejs/v1/admin",headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json"}});l.interceptors.request.use(function(t){return t.headers.Authorization=O,t},function(t){return Promise.reject(t)});l.interceptors.response.use(function(t){return t},function(t){return t.request.status,Promise.reject(t)});let y="absinthe";function q(){return l({url:`/${y}/orders`,method:"GET"})}function k(t,e){return l({url:`/${y}/orders`,method:"PUT",data:{data:{id:t,paid:e}}})}function R(t){return l({url:`/${y}/orders/${t}`,method:"DELETE"})}function j(){return l({url:`/${y}/orders`,method:"DELETE"})}let A=document.querySelector(".orderPage-tbody"),D=document.querySelector(".discardAllBtn"),b=document.querySelector(".section-revenue"),g=document.querySelector(".title-one"),$=document.querySelector(".title-two"),o=[],c="";function T(t){let e=new Date(t*1e3);return`<p>${e.getFullYear()}/${e.getMonth()+1}/${e.getDate()}</p>`}function x(t){let e="";return t.forEach(function(n){let i=n.price*n.quantity;e+=`<p><span>${n.title}(${n.price})</span> X <span>${n.quantity} ，共 ${i}元</span></p>`}),e}function P(t){if(t)return"已處理";if(!t)return"未處理"}function p(t){t.forEach(function(e){let n=P(e.paid),i=x(e.products),s=T(e.createdAt);c+=`<tr>
                        <td>${e.id}</td>
                        <td>
                            <p>${e.user.name}</p>
                            <p>${e.user.tel}</p>
                        </td>
                        <td>${e.user.address}</td>
                        <td>${e.user.email}</td>
                        <td>
                            <p>${i}</p>
                        </td>
                        <td>${s}</td>
                        <td class="orderStatus">
                            <a href="#"  data-put='revisebtn' data-pain=${e.paid} data-id=${e.id} >${n}</a>
                        </td>
                        <td>
                            <input type="button" class="delSingleOrder-Btn" value="刪除" data-orderbtn="del" data-id=${e.id} />
                        </td>
                    </tr>`})}function f(){A.innerHTML+=c}function v(){c="",A.innerHTML=c}function m(t){return t!=="true"}function B(t,e){return e.find(function(i){return t===i.id}).paid}function E(){if(o.length===0)return[];let t=[];return o.forEach(function(n){t.push(n.products)}),t.reduce(function(n,i){return n.concat(i)},[])}function S(){if(o.length===0)return[];let t=E(),e=[],n=[],i=t.reduce(function(s,r){return r.category in s?s[r.category]=s[r.category]+r.price*r.quantity:s[r.category]=r.price*r.quantity,s},{});return e=Object.keys(i),e.forEach(function(s){let r=[];r.push(s),r.push(i[s]),n.push(r)}),n}function h(){if(o.length===0)return[];let t=E(),e=[],n=[],i=[],s=3,r=t.reduce(function(u,a){return a.title in u?u[a.title]=u[a.title]+a.price*a.quantity:u[a.title]=a.price*a.quantity,u},{});if(e=Object.keys(r),e.forEach(function(u){let a=[];a.push(u),a.push(r[u]),n.push(a)}),n.sort(function(u,a){return u[1]-a[1]}),n.length<s)return n;for(;i.length<s;)if(i.push(n.pop()),i.length===s){let u=0;for(let a=0;a<n.length;a++)u=u+n[a][1];i.push(["其他",u])}return i}function d(t){c3.generate({bindto:"#chart",data:{type:"pie",columns:t},color:{pattern:["#FF0000","#EE7700","#66DD00","#009FCC"]}})}b.addEventListener("change",function(t){if(t.target.value==="類別營收比重"){let e=S();d(e),g.style.display="none",$.style.display="block"}if(t.target.value==="全品項營收比重"){let e=h();d(e),g.style.display="block",$.style.display="none"}});A.addEventListener("click",async function(t){t.preventDefault();let e=t.target.getAttribute("data-id"),n=t.target.getAttribute("data-put"),i=m(t.target.getAttribute("data-pain")),s=t.target.getAttribute("data-orderbtn");if(n==="revisebtn")try{let r=await k(e,i);console.log("reviseRes回應",r),o=r.data.orders,B(e,o)?Swal.fire({icon:"success",text:"買家已付款",timer:1e3,showConfirmButton:!1}):Swal.fire({icon:"error",text:"買家未付款",timer:1e3,showConfirmButton:!1}),v(),p(o),f()}catch(r){r.response.data.status||Swal.fire({icon:"error",title:" ",text:`${r.response.data.message}`})}if(s==="del")try{let r=await R(e);o=r.data.orders,r.data.status&&Swal.fire({icon:"success",title:" ",text:"該筆訂單已刪除"}),v(),p(o),f(),b.value==="全品項營收比重"?d(h()):d(S())}catch(r){r.response.data.status||Swal.fire({icon:"error",title:" ",text:`${r.response.data.message}`})}});D.addEventListener("click",async function(){try{let t=await j();t.data.status&&Swal.fire({icon:"success",title:" ",text:`${t.data.message}`}),o=[],v(),p(o),f(),d([])}catch(t){t.response.data.status||Swal.fire({icon:"error",title:" ",text:`${t.response.data.message}`})}});async function L(){o=(await q()).data.orders,g.style.display="block",$.style.display="none",p(o),f(),h(),d(h())}L();
