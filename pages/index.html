<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">  
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
    <style>
        /* 解決 bootStrap Modal 互動視窗 顯示 造成畫面抖動問題 */
        body.modal-open {
            overflow-y: auto !important;        
            padding-right: 0 !important;
        }


        /* SweetAlert2 使用 錯誤彈框 內部跑版修正 */
        .swal2-error {
            margin: 2.5em auto .6em !important;
            border: 0.25em solid rgba(0,0,0,0) !important;
            border-color: #f27474 !important;

        }
    </style>
</head>
<body class="">


  


    <nav class="topBar">
        <div class="wrap">
            <h1><a href="#" class="logo">WOWOROOM</a></h1>
            <span class="material-icons menuToggle">
                menu
            </span>
            <ul class="topBar-menu">
                <li><a href="#bedAdvantage">床墊優勢</a></li>
                <li><a href="#recommendation">好評推薦</a></li>
                <li><a href="#transport">運送方式</a></li>
                <li><a href="#orderInfo">立即預訂</a></li>
            </ul>
        </div>
    </nav>
    <section class="wrap" id="bedAdvantage">
        <div class="banner">
            <h2 class="banner-text">窩窩家居<br>跟您一起品味生活</h2>
        </div>
        <h3 class="section-title">床墊優勢</h3>
        <ul class="bedAdvantage">
            <li>
                <img class="bedAdvantage-img" src="../assets/images/final-img/tR426y5.png" alt="原木料環保">
                <p class="bedAdvantage-text">原木料環保</p>
            </li>
            <li>
                <img class="bedAdvantage-img" src="../assets/images/final-img/Fd2MiBb.png" alt="好收納">
                <p class="bedAdvantage-text">好收納</p>
            </li>
            <li>
                <img class="bedAdvantage-img" src="../assets//images/final-img/5n1uTFh.png" alt="好組裝">
                <p class="bedAdvantage-text">好組裝</p>
            </li>
        </ul>
    </section>
    <section class="furniture-compare">
        <div class="wrap">
            <h3 class="section-title">家具比較</h3>
            <div class="overflowWrap">
                <table class="compare-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>窩窩系統模組家具</th>
                            <th class="text-muted">組合式家具</th>
                            <th class="text-muted">實木家具</th>
                        </tr>
                    </thead>
                    <tr>
                        <td>可單人自行組裝</td>
                        <td><span class="material-icons">done</span></td>
                        <td class="text-muted">不一定</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>可多次重複拆裝</td>
                        <td><span class="material-icons">done</span></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>床墊規格彈性大</td>
                        <td><span class="material-icons">done</span></td>
                        <td class="text-muted">不一定</td>
                        <td class="text-muted">不一定</td>
                    </tr>
                    <tr>
                        <td>材質可長久使用</td>
                        <td><span class="material-icons">done</span></td>
                        <td></td>
                        <td><span class="material-icons">done</span></td>
                    </tr>
                    <tr>
                        <td>小客車即可搬運</td>
                        <td><span class="material-icons">done</span></td>
                        <td></td>
                        <td></td>
                    </tr>
                </table>
            </div>
        </div>
    </section>
    <section class="recommendation" id="recommendation">
        <div class="wrap">
            <h3 class="section-title">好評推薦</h3>
            <div class="recommendation-wall">
                <ul class="gallery-top">
                    <li class="recommendation-card">
                        <img src="../assets/images/final-img/cXcOLhu.png" alt="">
                        <div class="recommend-content">
                            <div class="recommend-img">
                                <img src="../assets/images/final-img/I9L7WOr.png" alt="">
                                <div>
                                    <p>王六角</p>
                                    <p class="recommend-text">Jodan 雙人床架</p>
                                </div>
                            </div>
                            <p>CP值很高。</p>
                        </div>
                    </li>
                    <li class="recommendation-card">
                        <img src="../assets/images/final-img/BefHmH2.png" alt="">
                        <div class="recommend-content">
                            <div class="recommend-img">
                                <img src="../assets/images/final-img/CUFGfay.png" alt="">
                                <div>
                                    <p>Leaf</p>
                                    <p class="recommend-text">Antony 雙人床架</p>
                                </div>
                            </div>
                            <p>很喜歡～還有送三年保固～</p>
                        </div>
                    </li>
                    <li class="recommendation-card">
                        <img src="../assets/images/final-img/3IATkJG.png" alt="">
                        <div class="recommend-content">
                            <div class="recommend-img">
                                <img src="../assets/images/final-img/8WwZsLS.png" alt="">
                                <div>
                                    <p>美濃鄧子琪</p>
                                    <p class="recommend-text">Charles 系列儲物組合</p>
                                </div>
                            </div>
                            <p>廚房必備美用品！</p>
                        </div>
                    </li>
                    <li class="recommendation-card">
                        <img src="../assets/images/final-img/HvT3zlU.png" alt="">
                        <div class="recommend-content">
                            <div class="recommend-img">
                                <img src="../assets/images/final-img/NycuPVy.png" alt="">
                                <div>
                                    <p>isRaynotArray</p>
                                    <p class="recommend-text">Antony 雙人床架</p>
                                </div>
                            </div>
                            <p>物超所值!</p>
                        </div>
                    </li>
                    <li class="recommendation-card">
                        <img src="../assets/images/final-img/Ed7bxLr.png" alt="">
                        <div class="recommend-content">
                            <div class="recommend-img">
                                <img src="../assets/images/final-img/zdFOQIv.png" alt="">
                                <div>
                                    <p>程鮭魚</p>
                                    <p class="recommend-text">Louvre 雙人床架</p>
                                </div>
                            </div>
                            <p>租屋用剛剛好</p>
                        </div>
                    </li>
                </ul>
                <ul class="gallery-bottom">
                    <li class="recommendation-card">
                        <img src="../assets/images/final-img/BefHmH2.png" alt="">
                        <div class="recommend-content">
                            <div class="recommend-img">
                                <img src="../assets/images/final-img/W7fyzp2.png" alt="">
                                <div>
                                    <p>小杰</p>
                                    <p class="recommend-text">Louvre 雙人床架</p>
                                </div>
                            </div>
                            <p>非常舒適，有需要會再回購</p>
                        </div>
                    </li>
                    <li class="recommendation-card">
                        <img src="../assets/images/final-img/mjA01Tk.png" alt="">
                        <div class="recommend-content">
                            <div class="recommend-img">
                                <img src="../assets/images/final-img/8O1cOnG.png" alt="">
                                <div>
                                    <p>江八角</p>
                                    <p class="recommend-text">Charles 雙人床架</p>
                                </div>
                            </div>
                            <p>品質不錯～</p>
                        </div>
                    </li>
                    <li class="recommendation-card">
                        <img src="../assets/images/final-img/npA3DgP.png" alt="">
                        <div class="recommend-content">
                            <div class="recommend-img">
                                <img src="../assets/images/final-img/C0NDvSA.png" alt="">
                                <div>
                                    <p>juni讚神</p>
                                    <p class="recommend-text">Antony 床邊桌</p>
                                </div>
                            </div>
                            <p>讚ㄉ！</p>
                        </div>
                    </li>
                    <li class="recommendation-card">
                        <img src="../assets/images/final-img/Ed7bxLr.png" alt="">
                        <div class="recommend-content">
                            <div class="recommend-img">
                                <img src="../assets/images/final-img/hUsTZDm.png" alt="">
                                <div>
                                    <p>久安說安安</p>
                                    <p class="recommend-text">Antony 單人床架</p>
                                </div>
                            </div>
                            <p>一個躺剛剛好。</p>
                        </div>
                    </li>
                    <li class="recommendation-card">
                        <img src="../assets/images/final-img/mjA01Tk.png" alt="">
                        <div class="recommend-content">
                            <div class="recommend-img">
                                <img src="../assets/images/final-img/3ako6QX.png" alt="">
                                <div>
                                    <p>PeiQun</p>
                                    <p class="recommend-text">Antony 雙人床架</p>
                                </div>
                            </div>
                            <p>睡起來很舒適</p>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </section>
    <section class="transport" id="transport">
        <h3 class="section-title">運送方式</h3>
        <ul class="transport-intro">
            <li class="transport-card">
                <div class="cardImg">
                    <span class="material-icons">
                        shopping_cart
                    </span>
                </div>
                <h4>STEP.1</h4>
                <p>選購商品</p>
            </li>
            <li class="transport-card">
                <div class="cardImg">
                    <span class="material-icons">
                        format_list_bulleted
                    </span>
                </div>
                <h4>STEP.2</h4>
                <p>填寫預定資料</p>
            </li>
            <li class="transport-card">
                <div class="cardImg">
                    <span class="material-icons">
                        done
                    </span>
                </div>
                <h4>STEP.3</h4>
                <p>預定成功</p>
            </li>
            <li class="transport-card">
                <div class="cardImg">
                    <span class="material-icons">
                        local_post_office
                    </span>
                </div>
                <h4>STEP.4</h4>
                <p>Email 付款資訊</p>
            </li>
        </ul>
    </section>
    <section class="wrap productDisplay">
        <select name="" class="productSelect">
            <option value="全部" selected>全部</option>
            <option value="床架">床架</option>
            <option value="收納">收納</option>
            <option value="窗簾">窗簾</option>
        </select>
        <ul class="productWrap">
            <!-- <li class="productCard">
                <h4 class="productType">新品</h4>
                <img src="https://hexschool-api.s3.us-west-2.amazonaws.com/custom/dp6gW6u5hkUxxCuNi8RjbfgufygamNzdVHWb15lHZTxqZQs0gdDunQBS7F6M3MdegcQmKfLLoxHGgV3kYunUF37DNn6coPH6NqzZwRfhbsmEblpJQLqXLg4yCqUwP3IE.png" alt="">
                <a href="#" class="addCardBtn" role="status" >加入購物車 
                    <button href="" class="spinner-border text-success disabled bg-black" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </button> 
                </a>
                <h3>Antony 雙人床架／雙人加大</h3>
                <del class="originPrice">NT$18,000</del>
                <p class="nowPrice">NT$12,000</p>
            </li>
            <li class="productCard">
                <h4 class="productType">新品</h4>
                <img src="https://hexschool-api.s3.us-west-2.amazonaws.com/custom/B87OUPkvlBvBl7Wyv3xj9ErOazczyGO8AFM5Nll38yEUvXMJHFXnid4g9YMzJOMq6t54ucmfgO4p7xw1azkleNYyhkEIINs8zJNbCPz1JUAZwaTKqIkaVQ3mRo2VBzAH.png" alt="">
                <a href="#" class="addCardBtn">加入購物車</a>
                <h3>Antony 雙人床架／雙人加大</h3>
                <del class="originPrice">NT$18,000</del>
                <p class="nowPrice">NT$12,000</p>
            </li>
            <li class="productCard">
                <h4 class="productType">新品</h4>
                <img src="https://hexschool-api.s3.us-west-2.amazonaws.com/custom/tTQQggBAfhl0vEeM7WmTwij1JbAwC7MBD2TSyjHbZHvBjnLU5tOtoGszOmODOEu6DRjzdjIpcEzeCCkmRWaL8JDJwaaWglER7P3V4JXKT7FT5gm0UL45CaHpSVlEXbKK.png" alt="">
                <a href="#" class="addCardBtn">加入購物車</a>
                <h3>Antony 雙人床架／雙人加大</h3>
                <del class="originPrice">NT$18,000</del>
                <p class="nowPrice">NT$12,000</p>
            </li>
            <li class="productCard">
                <h4 class="productType">新品</h4>
                <img src="https://hexschool-api.s3.us-west-2.amazonaws.com/custom/xgI6wM3uUCpkEEcauvHs67BFjGqG6Qxa9JTfOZTys6C0yJjqw5c8nJuA31gX77YVf04kZotGP9ZFQU7hLXkuoaRwNSssScpFnzfyPzYKODuyhw2QJrT1bDSim7aOBryv.png" alt="">
                <a href="#" class="addCardBtn">加入購物車</a>
                <h3>Antony 雙人床架／雙人加大</h3>
                <del class="originPrice">NT$18,000</del>
                <p class="nowPrice">NT$12,000</p>
            </li>
            <li class="productCard">
                <h4 class="productType">新品</h4>
                <img src="https://hexschool-api.s3.us-west-2.amazonaws.com/custom/Zr4h1Oqvc6NtAnpe5pNqJfGYyBJshAlKctfv0BTAZBqVAuvfSAWk4bcidBd8qBu1lRn5TWvib6O3UbmIAEt5w8SdB94GuFplZn6IM4SBvtxWJA2VnOqvQOsKungCPDXv.png" alt="">
                <a href="#" class="addCardBtn">加入購物車</a>
                <h3>Antony 雙人床架／雙人加大</h3>
                <del class="originPrice">NT$18,000</del>
                <p class="nowPrice">NT$12,000</p>
            </li>
            <li class="productCard">
                <h4 class="productType">新品</h4>
                <img src="https://hexschool-api.s3.us-west-2.amazonaws.com/custom/Tx99wDepg56aO5dGH7uGpU7REZwQLd1W0ec43M6cFw3o3z4eXTbeovq8WVseZ476BntlQnPPzaqkZgoj7xITviHMqf0kiAetjxyvuLiTmr7WdulcL364MTL321qZRJkP.png" alt="">
                <a href="#" class="addCardBtn">加入購物車</a>
                <h3>Antony 雙人床架／雙人加大</h3>
                <del class="originPrice">NT$18,000</del>
                <p class="nowPrice">NT$12,000</p>
            </li>
            <li class="productCard">
                <h4 class="productType">新品</h4>
                <img src="https://hexschool-api.s3.us-west-2.amazonaws.com/custom/VYPOpg83Jg7Ft5raI0eyzs6xSz0ttKzSJSklFq7il0HdwJ1iQ9kLHAU19rmkSapmyzRErTm1sxWO725W7CnowkRjwxgSyyRBo1ihGLwNbfYtgbo2nCTY9sarjqoxQbYX.png" alt="">
                <a href="#" class="addCardBtn">加入購物車</a>
                <h3>Antony 雙人床架／雙人加大</h3>
                <del class="originPrice">NT$18,000</del>
                <p class="nowPrice">NT$12,000</p>
            </li>
            <li class="productCard">
                <h4 class="productType">新品</h4>
                <img src="https://hexschool-api.s3.us-west-2.amazonaws.com/custom/XWnC8Of71WeSvCbkGy5MvZSyCrim50F9njuwHypcbiimd8tWscxGdecRAyaNheboQkqQAiCWK12GwuwMBvEtAarU2Y7mKTwKZIqhIExyQzbAbls7NTOdN2vX1OAyEaAN.png" alt="">
                <a href="#" class="addCardBtn">加入購物車</a>
                <h3>Antony 雙人床架／雙人加大</h3>
                <del class="originPrice">NT$18,000</del>
                <p class="nowPrice">NT$12,000</p>
            </li> -->
        </ul>
    </section>
    


    <section class="shoppingCart">
        <h3 class="section-title">我的購物車</h3>
        <div class="show-no-cart">
            <p>目前無任何商品</p>
        </div>
        <div class="overflowWrap show-cart-table">
          
            <table class="shoppingCart-table">
                <tbody class="tbody">
                   
                    <tr>
                        <th width="40%">品項</th>
                        <th width="15%">單價</th>
                        <th width="15%">數量</th>
                        <th width="15%">金額</th>
                        <th width="15%"></th>
                    </tr>
                    <!-- <tr>
                        <td>
                            <div class="cardItem-title">
                                <img src="https://i.imgur.com/HvT3zlU.png" alt="">
                                <p>Antony 雙人床架／雙人加大</p>
                            </div>
                        </td>
                        <td>NT$12,000</td>
                        <td>1</td>
                        <td>NT$12,000</td>
                        <td class="discardBtn">
                            <a href="#" class="material-icons d-none">
                                clear
                            </a>
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </td>
                    </tr> -->
                 
                    <tr>
                        <td>
                            <a href="#" class="discardAllBtn">刪除所有品項</a>
                        </td>
                        <td></td>
                        <td></td>
                        <td>
                            <p>總金額</p>
                        </td>
                        <td class="final-total"></td>
                    </tr>

                </tbody>
               
            </table>
        </div>
    </section>
    <section class="orderInfo wrap" id="orderInfo">
        <h3 class="section-title">填寫預訂資料</h3>
        <form action="" class="orderInfo-form">
            <div class="orderInfo-formGroup">
                <label for="customerName" class="orderInfo-label">姓名</label>
                <div class="orderInfo-inputWrap">
                    <input type="text" class="orderInfo-input" id="customerName" placeholder="請輸入姓名" name="姓名">
                    <p class="orderInfo-message" data-message="姓名">必填</p>
                </div>
            </div>
            <div class="orderInfo-formGroup">
                <label for="customerPhone" class="orderInfo-label">電話</label>
                <div class="orderInfo-inputWrap">
                    <input type="tel" class="orderInfo-input" id="customerPhone" placeholder="請輸入電話" name="電話">
                    <p class="orderInfo-message" data-message="電話">必填</p>
                </div>
            </div>
            <div class="orderInfo-formGroup">
                <label for="customerEmail" class="orderInfo-label">Email</label>
                <div class="orderInfo-inputWrap">
                    <input type="email" class="orderInfo-input" id="customerEmail" placeholder="請輸入 Email" name="Email">
                    <p class="orderInfo-message" data-message="Email">必填</p>
                </div>
            </div>
            <div class="orderInfo-formGroup">
                <label for="customerAddress" class="orderInfo-label">寄送地址</label>
                <div class="orderInfo-inputWrap">
                    <input type="text" class="orderInfo-input" id="customerAddress" placeholder="請輸入寄送地址" name="寄送地址">
                    <p class="orderInfo-message" data-message="寄送地址">必填</p>
                </div>
            </div>
            <div class="orderInfo-formGroup">
                <label for="tradeWay" class="orderInfo-label">交易方式</label>
                <div class="orderInfo-inputWrap">
                    <select id="tradeWay" class="orderInfo-input" name="交易方式">
                        <option value="ATM" selected>ATM</option>
                        <option value="信用卡">信用卡</option>
                        <option value="超商付款">超商付款</option>
                    </select>
                </div>
            </div>
            <input type="submit" value="送出預訂資料" class="orderInfo-btn"   >
            
        </form>
    </section>

    


    <!-- <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="../js/scroll.js"></script>
    <script type="module" src="../main.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/validate.js/0.13.1/validate.min.js"></script>
    <script type="module">
        import { getProductServer,addShopCartServer ,getShopCartServer,delShopCartServer,delAllShopCartServer,sendUserDate} from '../api/userAPI.js'
        import {createShopCartItem} from '../js/createCartItem.js'
        import {createLi } from '../js/createLi.js'

        (function(){
            let productList = document.querySelector('.productWrap')
           
            let shopCartTable = document.querySelector('.shoppingCart-table')
            let shopCartTbody =document.querySelector('.tbody')
            let productSelect = document.querySelector('.productSelect')
            let finalTotal = document.querySelector('.final-total')
            let discardAllBtn = document.querySelector('.discardAllBtn')


            let form = document.querySelector("form");
            let orderInfoInput = document.querySelectorAll('.orderInfo-input')
            let orderInfoMessage = document.querySelectorAll('.orderInfo-message')
            let orderInfoBtn = document.querySelector('.orderInfo-btn')
   
            let fragment = document.createDocumentFragment(); // 用於 添加多個D0OM元素時，不是直接一個一個添加，而是另一處新增完，再一次性的添加到dom元素上，以減少dom元素操作 提高性能
            let showCartTable = document.querySelector('.show-cart-table')
            let showNoCart = document.querySelector('.show-no-cart')
            let modalBody = document.querySelector('.modal-body')
            
            let productData = [] //遠端獲取產品列表資料後，所暫存的陣列。
            let productDataDom = [] // productData內的 dom元素
            let productLoadindDom =[] //存放 產品列表 的加入購物車的 轉圈圈 dom元素
            let addCardBtnDom = [] //產品列表 中 的 加入購物車 a連結dom元素
            
            let shopCartData = [] //遠端獲取 購物車資料後，所暫存的陣列。
            let cartLoadBtnDom = [] // 存放 刪除 顯示轉圈圈 按鈕 的dom元素
            let delBtnDom = [] //購物車 X的DOM元素
           
            
            let addCartLoadStatus = true  //新增商品的鎖，等待回傳成功，才能再次新增
            let delCartLoadStatus = true //刪除商品的鎖，等待回傳成功，才能再次刪除
            
            

            /*-----畫面處理-----*/

            //掛載產品列表 DOM元素
            function mountProductDOM(array,dom){
                array.forEach(function(item){
                    let temp = createLi(item)
                    fragment.appendChild(temp)
                })
                dom.appendChild(fragment)
            }
            // 篩選產品列表 dom元素 根據所篩選做 隱藏 跟 顯示
            function selectProductView(array){
                array.forEach(function(item,index){
                    if(item != undefined){
                        productDataDom[index].style.display = 'block'
                    }else{
                        productDataDom[index].style.display = 'none'
                    }
                })
            }

            //產品列表 加入購物車 樣式切換 ( 點加入購物車 其他沒點到的 按鈕文字顏色改變 且 取消 hover 效果 )
            function changeAddStyle(status){
                if( !status ){
                    addCardBtnDom.forEach(function(item){
                        item.classList.add('add-loading')
                    })
                }else{
                    addCardBtnDom.forEach(function(item){
                        item.classList.remove('add-loading')
                    })
                }
            }


            //掛載購物車列表 DOM元素
            function mountShopCartDOM(array,dom){
             
                let tempLength = shopCartTable.getElementsByTagName('tr').length - 1
                let lastDom = shopCartTable.getElementsByTagName('tr')[tempLength]
                array.forEach(function(item){
                    let temp = createShopCartItem(item)
                    fragment.appendChild(temp)
                })
                dom.insertBefore(fragment,lastDom)
            }
            //清空購物車列表 DOM元素
            function resetShopCartDOM(){
               
                let domLength = shopCartTable.getElementsByTagName('tr').length - 1
                let firstDom =shopCartTable.getElementsByTagName('tr')[0]
                let lastDom = shopCartTable.getElementsByTagName('tr')[domLength]
                while(shopCartTbody.firstChild){
                    shopCartTbody.removeChild(shopCartTbody.firstChild)
                }
                       
                fragment.appendChild(firstDom)
                fragment.appendChild(lastDom)
                shopCartTbody.appendChild(fragment)
                
            
            }
            //server 回傳 若購物車沒東西，顯示/不顯示 相關訊息
            function showCartMessage(array){
                if(array.length === 0){
                    showCartTable.style.display = 'none'
                    showNoCart.style.display = 'block'
                }else{
                    showCartTable.style.display = 'block'
                    showNoCart.style.display = 'none'
                }
            }
            //更新 購物車列表 畫面
            function upDateShopCartDom(){
                resetShopCartDOM()
                mountShopCartDOM(shopCartData,shopCartTbody)
                showCartMessage(shopCartData)
                cartLoadBtnDom = Array.from(document.querySelectorAll('.loadind-cart'))
                delBtnDom =  Array.from(document.querySelectorAll('.a-delbtn'))
                // finalTotal.textContent = `NT$ ${obj.finalTotal.toLocaleString()}`
            }
            
    

      

            //顯示 產品列表 加入商品時的 loading圖案
            function productLoadingShow(index){
                productLoadindDom[index].style.display = 'block'
            }

            //關閉 產品列表 加入商品時的 loading圖案
            function productLoadingClose(index){
                productLoadindDom[index].style.display = 'none'
            }

            //顯示/隱藏 刪除轉圈圈 跟 X按鈕
            function delCartLoadView(index){
                cartLoadBtnDom[index].style.display = 'block'
                delBtnDom[index].style.display  = 'none'
                
            }

            //點刪除，沒被點到刪除的顏色更改 且 取消 hover 效果
            function delBtnDomStyle(status){
                if(!status){
                    delBtnDom.forEach(function(item){
                       item.classList.add('del-loading')
                    })
                }else{
                    delBtnDom.forEach(function(item){
                        item.classList.remove('del-loading')
                    })
                }
            }

             //顯示/隱藏 刪除轉圈圈 跟 X按鈕
            function delCartLoadAll(){
                cartLoadBtnDom.forEach(function(item){
                    item.style.display = 'block'
                })
                delBtnDom.forEach(function(item){
                    item.style.display = 'none'
                })
            }
      
    
            /*-----資料處理-----*/
            
            //確認數量
            function verifyQuantity(id){
                let product = {}
                let temp = shopCartData.find(function(item){
                    return item.product.id === id
                })
                if(temp){
                    product.id = id;
                    product.quantity = temp.quantity+1;
                }else{
                    product.id = id;
                    product.quantity = 1
                }
                return product
            }

            //篩選 產品資訊陣列
            function selectProductIndex(string,array){
                let temp = array.map(function(item,index){
                    if( item.category === `${string}` ){
                        return index
                    }
                })
                return temp
            }

            // 獲取 點擊 產品列表 的 加入購物車 的 dom元素 索引值
            function productLoadingIndex(id){
                let index = productData.findIndex(function(item){
                    return item.id === id
                })
                return index
            }

             // 獲取 點擊 刪除購物車 的 dom元素 索引值
            function delCartLoadIndex(id){
                let cartIndex = shopCartData.findIndex(function(item){
                    return item.id === id
                })
                return cartIndex
            }
   
            //使用 swal套件 的 toast設定
            const Toast = Swal.mixin({
                toast: true,
                position: "top",
                showConfirmButton: false,
                timer: 1500,
                // timerProgressBar: true,
                background :'#9D9D9D',
                didOpen: (toast) => {
                    toast.onmouseenter = Swal.stopTimer;
                    toast.onmouseleave = Swal.resumeTimer;
                }
            });
            // swal套件使用
            function toastAlert(icon,title){
                Toast.fire({
                    icon: icon,
                    title: title
                },)
            }

            
            /*-----各項監聽-----*/

            //產品列表 
            productList.addEventListener('click',async function(e){
                e.preventDefault();
                let pruductId = e.target.getAttribute('data-addcartid')
                if(e.target.getAttribute('class')==='addCardBtn'){
                    if(addCartLoadStatus){
                        let  loadingIndex = productLoadingIndex(pruductId)
                        let product = verifyQuantity(pruductId)
                        addCartLoadStatus = false
                        productLoadingShow(loadingIndex)
                        changeAddStyle(addCartLoadStatus)

                        try {
                            let addCartRes = await addShopCartServer(product.id,product.quantity) //將前端資料傳送到後端(加入購物車)
                            // console.log('新增購物車項目回應',addCartRes)
                            shopCartData = addCartRes.data.carts
                            addCartLoadStatus = true
                            upDateShopCartDom()
                            productLoadingClose(loadingIndex)
                            changeAddStyle(addCartLoadStatus)
                            toastAlert('success','已成功加入')
              
                            finalTotal.textContent = `NT$ ${addCartRes.data.finalTotal.toLocaleString()}`
                        }catch (error) {
                            if(!error.response.data.status){
      
                                Swal.fire({
                                    icon: "error",
                                    title: " ",
                                    text: `${error.response.data.message}`,
         
                                });
                            }
                            addCartLoadStatus = true
                            productLoadingClose(loadingIndex)
                            changeAddStyle(addCartLoadStatus)
                        }
                    }
 
                }       
            
            })
            //產品列表 篩選
            productSelect.addEventListener('change', function(e){
                let str = e.target.value 
                if(e.target.value === '全部'){
                    //點擊 全部 將所有列表顯示
                    productDataDom.forEach(function(item){
                        item.style.display = 'block'
                    })
       
                }else{
                    //點擊 非全部 依條件 將列表 顯示 或 隱藏
                    let temp = selectProductIndex(str,productData)
                    selectProductView(temp)
                }

            })


            //購物車列表
            shopCartTable.addEventListener('click',async function(e){
                e.preventDefault()
                let delId = e.target.getAttribute('data-delcartid');
                let delOne = e.target.getAttribute('data-delBtn')
                if(delOne === 'delOneData'){
                    if(delCartLoadStatus){

                        delCartLoadStatus = false
                        delCartLoadView( delCartLoadIndex(delId) )
                       delBtnDomStyle(delCartLoadStatus)
                        try{
                            let delCartRes = await delShopCartServer(delId) //發送 刪除該筆購物車項目請求(單筆)
                            // console.log('刪除單筆購物車項目回應',delCartRes.data)
                            shopCartData = delCartRes.data.carts
                            delCartLoadStatus = true
                            upDateShopCartDom()
                            delBtnDomStyle(delCartLoadStatus)
                            toastAlert('success','已將商品移除')
             
                            finalTotal.textContent = `NT$ ${delCartRes.data.finalTotal.toLocaleString()}`
                        }catch(errer){
                            if(!error.response.data.status){
                                Swal.fire({
                                    icon: "error",
                                    title: " ",
                                    text: `${error.response.data.message}`,

                                });
        
                            }
                            delCartLoadStatus = true
                            delBtnDomStyle(delCartLoadStatus)
                        }
                    }

                }
            })
            
            // 刪除全部購物車內容 按鈕
            discardAllBtn.addEventListener('click',async function(e){
                e.preventDefault()
                delCartLoadStatus = false
                delBtnDomStyle(delCartLoadStatus)
                try{
                    delCartLoadAll()
                    let delAllRes = await delAllShopCartServer() //發送 刪除全部購物車項目請求
                    // console.log('刪除全部購物車項目回應',delAllRes.data)
                    shopCartData = delAllRes.data.carts
                    delCartLoadStatus = true
                    upDateShopCartDom()
                    delBtnDomStyle(delCartLoadStatus)
                    toastAlert('success','已將商品全部移除')
     
                    finalTotal.textContent = `NT$ ${delAllRes.data.finalTotal.toLocaleString()}`

                    // cartLoading.style.display ='none'
                }catch(errer){
                    if(!error.response.data.status){
                        Swal.fire({
                            icon: "error",
                            title: " ",
                            text: `${error.response.data.message}`,
  
                        });

                    }
                    delCartLoadStatus = true
                    delBtnDomStyle(delCartLoadStatus)
                }

            })
            //初始化設定
            async function initialization(){
                closeFormMessage()
                try{
                    let getData = await getProductServer() //取的產品列表資料
                    let getShopCartData = await getShopCartServer()  //取的購物車列表資料
                    productData = getData.data.products
                    shopCartData = getShopCartData.data.carts

                    
                    mountProductDOM(productData,productList)
                    mountShopCartDOM(shopCartData,shopCartTbody)
                    showCartMessage(shopCartData)
                    console.log(productData)
                    productDataDom = Array.from(document.querySelectorAll('.productCard'))
                    productLoadindDom =Array.from(document.querySelectorAll('.loadind-btn')) 
                    cartLoadBtnDom = Array.from(document.querySelectorAll('.loadind-cart'))
                    delBtnDom = document.querySelectorAll('.a-delbtn')
                    addCardBtnDom = document.querySelectorAll('.addCardBtn')

                    finalTotal.textContent = `NT$ ${getShopCartData.data.finalTotal.toLocaleString()}`
                    
                }catch(error){
                    if(!error.response.data.status){
                        Swal.fire({
                            icon: "error",
                            title: " ",
                            text: `${error.response.data.message}`,
                        });
                    }
                }
               
            }
            //初始化
            initialization()

            
            let constraints = {
                "姓名": {// 對應 input 的 name
                    presence:{
                        message:'必填'
                    },
                },
                "電話":{
                    presence:{
                        message:'必填'
                    },
                },
                "Email":{
                    presence:{
                        message:'必填'
                    },
                    email:{
                        message:"須符合Email格式"
                    }
                },
                "寄送地址":{
                    presence:{
                        message:'必填'
                    },
                }
            };
            
            orderInfoBtn.addEventListener('click',async function(e){
                e.preventDefault()        
                const errorMessage = validate(form, constraints);
                if(errorMessage){
                    let temp =  saveFormError(errorMessage)
                    showFormMessage(temp)
                    return 
                }
                closeFormMessage()
                let user={
                    name:orderInfoInput[0].value,
                    tel:orderInfoInput[1].value,
                    email:orderInfoInput[2].value,
                    address:orderInfoInput[3].value,
                    payment:orderInfoInput[4].value
                }
                try{
                    let senDataRes = await sendUserDate(user)
                    // console.log('傳送訂單成功後回應',senDataRes)
                    if(senDataRes.status){
                        shopCartData =[]
                        upDateShopCartDom()
                        toastAlert('success','訂單已成立')
                        // swal({
                        //     icon: "success",
                        //     title:'訂單已成立'
                        // });
                        form.reset()
                        finalTotal.textContent = `NT$ ${0}`
                        
                    }
                }catch(error){
                    // console.log(error)
                    if(!error.response.data.status){
                        Swal.fire({
                            icon: "error",
                            title: " ",
                            text: `${error.response.data.message}`,
                        });
                    }
                }
            })

            
            //關閉表單警告格式錯誤訊息
            function closeFormMessage(){
                orderInfoMessage.forEach(function(item){
                    item.textContent = ''
                })
            }

            //針對表單格式錯誤訊息做處理
            function saveFormError(error){
                let temp = []
                let orderInfoMessageIndex={
                    "姓名":0,
                    "電話":1,
                    "Email":2,
                    "寄送地址":3,
                }
                Object.entries(error).forEach(function(item){
                    let arr = []
                    arr.push(orderInfoMessageIndex[ item[0] ])
                    arr.push(item[1][0].replace(item[0],''))
                    temp.push(arr)
                })
                return temp
            }
            //透過上方 saveFormError() 設定 可以直接對應各input的錯誤
            function showFormMessage(array){
                for(let i =0 ;i < array.length;i++){
                    orderInfoMessage[ array[i][0] ].style.display ='block'
                    orderInfoMessage[ array[i][0] ].textContent =array[i][1].trim()
                }
            }
        })();





    </script> 
</body>
</html>